// ==UserScript==
// @name             MUJS
// @namespace        http://myuserjs.org/
// @author           jgjake2
// @homepage         http://myuserjs.org/
// @include          *
// @version          0.0.11
// @grant            unsafeWindow
// @grant            GM_info
// @grant            GM_log
// @grant            GM_getMetadata
// @grant            GM_xmlhttpRequest
// @grant            GM_registerMenuCommand
// @unwrap
// @run-at document-start
// ==/UserScript==
if(typeof unsafeWindow==="undefined")unsafeWindow=window;MUJS=function(arg1,arg2){return MUJS.init.apply(MUJS,Array.prototype.slice.call(arguments,0))};
(function(MUJS,$){var mujsAPILoadStart=-1;var mujsAPILoadEnd=-1;if(typeof unsafeWindow.performance!=="undefined"&&typeof unsafeWindow.performance.timing!=="undefined")mujsAPILoadStart=unsafeWindow.performance.now();MUJS.__defineGetter__("version",function(){return"0.0.11"});MUJS.__defineGetter__("build_time",function(){return"1418405339000"});MUJS["fn"]=MUJS.__proto__;MUJS.API=new function(){this["fn"]=this.__proto__};MUJS.fn.init=function(){var args=Array.prototype.slice.call(arguments,0);try{if(args.length>
0)if(typeof args[0]==="string"){if(args[0]=="get")return MUJS.config(args[1]);if(args[0]=="set")return MUJS.config(args[1],args[2])}else if(typeof args[0]==="object")if(typeof args[0]["ginfo"]!=="undefined")return MUJS.setScriptInfo.apply(MUJS,args)}catch(e){}};if(console)console.log("Loading MUJS API v"+MUJS.version+" - "+(new Date(parseInt(MUJS.build_time))).toString());var URLBuilder=function(input){var r={protocol:"http:",hostname:"",pathname:"",args:[],setHostname:function(str){var parser=document.createElement("a");
if(!/https?\:\/\//i.test(str))str="http://"+str;parser.href=str;this.hostname=parser.hostname;this.protocol=parser.protocol},setPath:function(str){if(str[0]!="/")str="/"+str;this.pathname=str},addArg:function(key,value){this.args.push([key,value])},addArgs:function(args){for(var i=0;i<args.length;i++)this.addArg(args[i])},buildArgs:function(){var argStr="";var argsArr=[];for(var i=0;i<this.args.length;i++)argsArr.push(this.args[i].join("="));return argsArr.join("&")},toString:function(){return this.protocol+
"//"+this.hostname+this.pathname+"?"+this.buildArgs()}};if(typeof input!=="undefined")r.setHostname(input);return r};function mExportFunction(func,scope,args){if(typeof exportFunction!=="undefined")exportFunction(func,scope,args);else{var name;if(typeof args==="undefined")args={};if(typeof args.defineAs!=="undefined")name=args.defineAs;else if(typeof func==="function"&&func.name!="")name=func.name;scope[name||""]=func}}var mCloneInto=this.mCloneInto=function(obj,scope,args){if(typeof cloneInto!==
"undefined")cloneInto(obj,scope,args);else return obj};function Object_SearchForKey(str){var names=str.split(".");var tmp=this;for(var i=0;i<names.length;i++){if(typeof tmp[names[i]]==="undefined")return undefined;tmp=tmp[names[i]]}return tmp}function Object_setKeyValue(str,val,force){var names=str.split(".");var tmp=this;for(var index=0;index<names.length-1;index++){if(typeof tmp[names[index]]==="undefined")if(force)tmp[names[index]]=new Object;else return;tmp=tmp[names[index]]}tmp[names[names.length-
1]]=val}function RealTypeOf(obj){try{if(typeof obj==="undefined")return"undefined";if(typeof obj==="number"&&isNaN(obj)==true)return"nan";if(typeof obj==="object"){if(obj===null)return"null";if(obj.constructor==={}.constructor)return"map";if(obj.constructor===(new Array).constructor)return"array";if(obj.constructor===(new Date).constructor){if(isNaN(obj.getTime()))return"invaliddate";return"date"}if(obj.constructor===(new RegExp).constructor)return"regex";return Object.prototype.toString.call(obj).replace(/^\[object |\]$/g,
"").toLowerCase()}return typeof obj}catch(e){return typeof obj}}function clone(obj){if(obj==null||typeof obj!="object")return obj;var temp;try{temp=obj.constructor()}catch(e){switch(RealTypeOf(obj)){case "number":temp=(new Number).constructor();break;case "array":temp=(new Array).constructor();break;case "map":temp={}.constructor();break;default:temp=obj;break}}for(var key in obj)if(obj.hasOwnProperty(key))temp[key]=clone(obj[key]);return temp}function mergeObjects(obj1,obj2){if(obj2==null||["string",
"number","date","regex","undefined"].indexOf(RealTypeOf(obj2))!=-1)return clone(obj2);var objOut=clone(obj1);for(var key in obj2)if(typeof objOut[key]==="undefined"||obj2[key]==null||typeof obj2[key]!="object")objOut[key]=clone(obj2[key]);else if(objOut[key]==null||RealTypeOf(objOut[key])=="array"||typeof objOut[key]!="object")objOut[key]=clone(obj2[key]);else objOut[key]=mergeObjects(objOut[key],obj2[key]);return objOut}function merge(){var args=Array.prototype.slice.call(arguments);if(args.length==
0)return undefined;if(args.length==1)return args[0];var tmp=args[0];for(var i=1;i<args.length;i++)tmp=mergeObjects(tmp,args[i]);return tmp}var props={SearchForKey:{value:Object_SearchForKey,enumerable:false},setKeyValue:{value:Object_setKeyValue,enumerable:false}};var performance=new function(){var getPerformancePtr=function(){return typeof unsafeWindow.performance!=="undefined"&&typeof unsafeWindow.performance.timing!=="undefined"?unsafeWindow.performance:undefined};var _performancePtr=undefined;
this.__defineGetter__("available",function(){return typeof this.performancePtr==="undefined"?false:true});this.__defineGetter__("now",function(){return this.performancePtr.now()});this.__defineGetter__("performancePtr",function(){if(typeof _performancePtr==="undefined")_performancePtr=getPerformancePtr();return _performancePtr});this.get=function(str){if(typeof this.performancePtr==="undefined")return undefined;var names=str.split(".");var tmp=this.performancePtr;for(var i=0;i<names.length;i++){if(typeof tmp[names[i]]===
"undefined")return undefined;tmp=tmp[names[i]]}return tmp};this.getAllTiming=function(ignore){if(typeof ignore==="undefined")ignore=[];var timingData=[];var ptr=this.performancePtr;for(var key in ptr.timing)if(!isNaN(ptr.timing[key])&&ignore.indexOf(key)==-1)timingData[key]=parseInt(ptr.timing[key]);return timingData}};MUJS["Config"]={"host":"http://myuserjs.org","scopeLock":typeof exportFunction==="undefined"?false:true,"secure":false,"script":{username:undefined,script_name:undefined},"Update":{"DOMTiming":false,
"args":{},"updateVeriableName":"USMetaData","getType":"data","jQuery":false,"XMLHttpRequest":false,"getStats":false,"sampleRate":100},"Error":{"autoReportErrors":false,"errorFilter":function(message,url,linenumber){return true}},"API":{"log":{"disabled_functions":[],"hidden_classes":[],"verbosity_level":5},"localStorage":{"storage_prefix":"MUJS_"}},"debug":false};Object.defineProperties(MUJS.Config,props);if(typeof unsafeWindow["MUJS_CONFIGURATION"]!=="undefined")MUJS.Config=merge(MUJS.Config,unsafeWindow["MUJS_CONFIGURATION"]);
if(typeof unsafeWindow["MUJS_UPDATE_CONFIGURATION"]!=="undefined")MUJS.Config.Update=merge(MUJS.Config.Update,unsafeWindow["MUJS_UPDATE_CONFIGURATION"]);Object.defineProperties(MUJS.Config,props);Object.defineProperty(MUJS,"config",{value:function(key,value){if(typeof value==="undefined")return MUJS.Config.SearchForKey(key);else return MUJS.Config.setKeyValue(key,value)},enumerable:false});MUJS["events"]={"e":{},"fired":{},"addEvent":function(name){this.e[name]=[];Object.defineProperty(MUJS,name,
new function(propName){return{set:function(callback){MUJS["events"]["addListener"](propName,callback)},enumerable:false}}(name))},"addListener":function(name,callback){if(typeof this.fired[name]==="undefined")this.e[name].push(callback);else callback.apply(MUJS,this.fired[name])},"fire":function(name){var args=Array.prototype.slice.call(arguments,1);this.fired[name]=args;if(typeof this.e[name]!=="undefined"){var putBack=[];while(i=this.e[name].pop())if(!i.apply(null,args))putBack.push(i);this.e[name]=
putBack}}};MUJS["events"]["addEvent"]("onReady");MUJS["events"]["addEvent"]("onPageReady");MUJS.fn.setScriptInfo=function(data){var callerScriptInfo;var output={};try{var genErrorVariable=genErrorFunction(genErrorArg)}catch(e){var tStack=MUJS.ERROR.parseStack(e.stack.toString());if(tStack.length>0)for(var i=tStack.length-1;i>=0;i--)if(tStack[i].fileName!=""&&tStack[i].fileExt.toLowerCase()=="user.js"){callerScriptInfo=tStack[i];output.userscript_file_name=callerScriptInfo.fileName;output.userscript_file_path=
callerScriptInfo.fullFileName;break}}try{if(typeof data.ginfo!=="undefined"){if(typeof data.ginfo.script!=="undefined")for(var key in data.ginfo.script)if(typeof output[key]==="undefined")output[key]=data.ginfo.script[key];if(typeof data.ginfo.uuid!=="undefined")output["gmUUID"]=data.ginfo.uuid;else if(typeof data.ginfo.script.uuid!=="undefined")output["gmUUID"]=data.ginfo.script.uuid;if(typeof GM_info.scriptHandler!=="undefined")if(GM_info.scriptHandler.toLowerCase()=="tampermonkey"){output.script_handler=
"Tampermonkey";output.script_handler_version=GM_info.version}else{if(GM_info.scriptHandler.toLowerCase()=="greasemonkey"){output.script_handler="Greasemonkey";output.script_handler_version=GM_info.version}}else if(data.has_GM_info){output.script_handler="Greasemonkey";output.script_handler_version=GM_info.version}else if(data.has_GM_getMetadata)output.script_handler="Scriptish"}}catch(e){}Object.defineProperty(MUJS.Config.Update,"script_info",{value:Object.freeze(output),writable:false,enumerable:true,
configurable:false});return Object.freeze(output)};MUJS.fn.getScriptInfo=function(data){if(typeof MUJS.config("Update.script_info")==="undefined")MUJS.setScriptInfo(data);return MUJS.config("Update.script_info")};var OUTPUT_TYPES={"ERROR":{level:1,value:"error"},"WARNING":{level:2,value:"warn"},"INFO":{level:3,value:"info"},"LOG":{level:4,value:"log"},"DEBUG":{level:5,value:"debug"}};function isFirebug(ptr){if(typeof ptr==="undefined")return false;if(typeof ptr["timeStamp"]!=="undefined")return true;
return false}function isConsole2(ptr){if(typeof ptr==="undefined")return false;if(!isFirebug(ptr))if(typeof ptr["dirxml"]!=="undefined")return true;return false}function isWebConsole(ptr){if(typeof ptr!=="undefined"&&typeof ptr["dirxml"]==="undefined")return true;return false}function getFB(){if(isFirebug(this.console))return this.console;if(isFirebug(console))return console;if(isFirebug(window.console))return window.console;if(isFirebug(unsafeWindow.console))return unsafeWindow.console;if(isFirebug(unsafeWindow.window.console))return unsafeWindow.window.console;
if(isFirebug(window.console))return window.console;return undefined}function getC2(){if(isConsole2(console))return console;if(isConsole2(this.console))return this.console;if(isConsole2(unsafeWindow.console))return unsafeWindow.console;if(isConsole2(unsafeWindow.window.console))return unsafeWindow.window.console;if(isConsole2(window.console))return window.console;return undefined}function getWC(){if(isWebConsole(unsafeWindow.window.console))return unsafeWindow.window.console;if(isWebConsole(window.console))return window.console;
return undefined}function MUJS_Log(fb_ptr,c2_ptr,wc_ptr){var tmp_fb_ptr=isFirebug(fb_ptr)?fb_ptr:undefined;var tmp_c2_ptr=isFirebug(c2_ptr)?c2_ptr:undefined;var tmp_wc_ptr=isFirebug(wc_ptr)?wc_ptr:undefined;return{"Firebug_ptr":tmp_fb_ptr,"Console2_ptr":tmp_c2_ptr,"WebConsole_ptr":tmp_wc_ptr,"OUTPUT_TYPES":OUTPUT_TYPES,"updateFirebugPtr":function(new_ptr){if(typeof this["Firebug_ptr"]==="undefined"&&isFirebug(new_ptr))this.Firebug_ptr=new_ptr},"updateConsole2Ptr":function(new_ptr){if(typeof this["Console2_ptr"]===
"undefined"&&isConsole2(new_ptr))this.Console2_ptr=new_ptr},"updateWebConsolePtr":function(new_ptr){if(typeof this["WebConsole_ptr"]==="undefined"&&isWebConsole(new_ptr))this.WebConsole_ptr=new_ptr},"ConsoleCommand":function(command,value){try{var args=Array.prototype.slice.call(arguments,1);var safeArgs=mCloneInto(args,unsafeWindow,{cloneFunctions:true,wrapReflectors:true});if(typeof this.Firebug_ptr!=="undefined"&&typeof this.Firebug_ptr[command]!=="undefined")this.Firebug_ptr[command].apply(this.Firebug_ptr,
safeArgs);if(typeof this.Console2_ptr!=="undefined"&&typeof this.Console2_ptr[command]!=="undefined")this.Console2_ptr[command].apply(this.Console2_ptr,safeArgs);if(typeof this.WebConsole_ptr!=="undefined"&&typeof this.WebConsole_ptr[command]!=="undefined")this.WebConsole_ptr[command].apply(this.WebConsole_ptr,safeArgs)}catch(e){console.log("ConsoleCommand Error! getUpdateData: ",e.name,e.fileName,e.lineNumber+":"+e.columnNumber);console.log(e);console.trace(e)}},"outputMessage":function(output_type,
str){if(output_type.level<=MUJS.config("API.log.verbosity_level"))this.ConsoleCommand.apply(this,[output_type.value].concat(Array.prototype.slice.call(arguments,1)))},"Error":function(category,x){this["outputMessage"].apply(this,[OUTPUT_TYPES["ERROR"],"C.CE Error ("+category+") - "+x.name+" - "+x.message+" in file <"+x.fileName+"> on line "+x.lineNumber])},"logError":this["Error"],"Warning":function(str){this["outputMessage"].apply(this,[OUTPUT_TYPES["WARNING"]].concat(Array.prototype.slice.call(arguments,
0)))},"Info":function(str){this["outputMessage"].apply(this,[OUTPUT_TYPES["INFO"]].concat(Array.prototype.slice.call(arguments,0)))},"Log":function(str){this["outputMessage"].apply(this,[OUTPUT_TYPES["LOG"]].concat(Array.prototype.slice.call(arguments,0)))},"Debug":function(str){this["outputMessage"](OUTPUT_TYPES["DEBUG"],str)},"table":function(data){this.ConsoleCommand("table",Array.prototype.slice.call(arguments,0))},"count":function(title){if(MUJS.config("API.log.disabled_functions").indexOf("count")==
-1)this.ConsoleCommand("count",title)},"startGroup":function(title){if(MUJS.config("API.log.disabled_functions").indexOf("startGroup")==-1&&MUJS.config("API.log.disabled_functions").indexOf("groupEnd")==-1&&MUJS.config("API.log.disabled_functions").indexOf("groupCollapsed")==-1)this.ConsoleCommand("group",title)},"endGroup":function(){if(MUJS.config("API.log.disabled_functions").indexOf("startGroup")==-1&&MUJS.config("API.log.disabled_functions").indexOf("groupEnd")==-1&&MUJS.config("API.log.disabled_functions").indexOf("groupCollapsed")==
-1)this.ConsoleCommand("groupEnd")},"groupCollapsed":function(title){if(MUJS.config("API.log.disabled_functions").indexOf("startGroup")==-1&&MUJS.config("API.log.disabled_functions").indexOf("groupEnd")==-1&&MUJS.config("API.log.disabled_functions").indexOf("groupCollapsed")==-1)this.ConsoleCommand("groupCollapsed",title)},"time":function(name){if(MUJS.config("API.log.disabled_functions").indexOf("time")==-1&&MUJS.config("API.log.disabled_functions").indexOf("timeEnd")==-1)this.ConsoleCommand("time",
name)},"timeEnd":function(name){if(MUJS.config("API.log.disabled_functions").indexOf("time")==-1&&MUJS.config("API.log.disabled_functions").indexOf("timeEnd")==-1)this.ConsoleCommand("timeEnd",name)},"timeStamp":function(name){if(MUJS.config("API.log.disabled_functions").indexOf("timeStamp")==-1)this.ConsoleCommand("timeStamp",name)},"assert":function(expression,obj){var args=Array.prototype.slice.call(arguments,0);args.unshift("assert");if(MUJS.config("API.log.disabled_functions").indexOf("assert")==
-1)this.ConsoleCommand.apply(this,args)},"trace":function(){if(MUJS.config("API.log.disabled_functions").indexOf("trace")==-1)this.ConsoleCommand("trace")},"clear":function(){if(MUJS.config("API.log.disabled_functions").indexOf("clear")==-1)this.ConsoleCommand("clear")},"profile":function(name){var args=Array.prototype.slice.call(arguments,0);args.unshift("profile");if(MUJS.config("API.log.disabled_functions").indexOf("profile")==-1&&MUJS.config("API.log.disabled_functions").indexOf("profileEnd")==
-1)this.ConsoleCommand.apply(this,args)},"profileEnd":function(){var args=Array.prototype.slice.call(arguments,0);args.unshift("profileEnd");if(MUJS.config("API.log.disabled_functions").indexOf("profile")==-1&&MUJS.config("API.log.disabled_functions").indexOf("profileEnd")==-1)this.ConsoleCommand.apply(this,args)}}}function UpdateAllPtrs(){MUJS.API.MUJS_Log.updateFirebugPtr(getFB());MUJS.API.MUJS_Log.updateConsole2Ptr(getC2());MUJS.API.MUJS_Log.updateWebConsolePtr(getWC())}var MUJS_Log_Functions=
["Debug","Log","Info","Warning","Error"];MUJS.API.fn.MUJS_Log=new MUJS_Log(getFB(),getC2(),getWC());MUJS.fn.log=MUJS.API.MUJS_Log;MUJS.fn.log.UpdateAllPtrs=UpdateAllPtrs;for(var i=0;i<MUJS_Log_Functions.length;i++)MUJS.fn[MUJS_Log_Functions[i]]=MUJS.API.MUJS_Log[MUJS_Log_Functions[i]].bind(MUJS.API.MUJS_Log);MUJS.API.addStyle=function(css){if(typeof css!="undefined"&&css!="")if(heads=document.getElementsByTagName("head")){var style=document.createElement("style");try{style.innerHTML=css}catch(x){style.innerText=
css}style.type="text/css";return heads[0].appendChild(style)}return null};MUJS.API.addScript=function(js,src,id,async){if(heads=document.getElementsByTagName("head")){var newScript=document.createElement("script");if(typeof js!="undefined"&&js!="")try{newScript.innerHTML=js}catch(x){newScript.innerText=js}if(typeof src!="undefined"&&src!="")try{newScript.src=src}catch(x){}if(typeof id!=="undefined")try{newScript.id=id}catch(x){}if(typeof async!=="undefined")newScript.async=true;newScript.type="text/javascript";
try{return heads[0].appendChild(newScript)}catch(x){}}return null};MUJS.API.contentEval=function(source){if("function"==typeof source)source="("+source+")();";var script=document.createElement("script");script.setAttribute("type","application/javascript");script.textContent=source;unsafeWindow.document.body.appendChild(script);unsafeWindow.document.body.removeChild(script)};Object.defineProperty(MUJS,"stor",{value:function(){return localStorage?localStorage:unsafeWindow.localStorage?unsafeWindow.localStorage:
window.localStorage}(),enumerable:false});MUJS.API.localStorage={};MUJS.API.localStorage.getValue=function(key,def){var name=MUJS.config("API.localStorage.storage_prefix")+key;if(MUJS.stor[name]){var value=MUJS.stor.getItem(name);return value}return def};MUJS.API.localStorage.setValue=function(key,value){var name=MUJS.config("API.localStorage.storage_prefix")+key;return MUJS.stor.setItem(name,value)};MUJS.API.localStorage.deleteValue=function(key,value){var name=MUJS.config("API.localStorage.storage_prefix")+
key;return MUJS.stor.removeItem(name)};MUJS.fn.getValue=MUJS.API.localStorage.getValue;MUJS.fn.setValue=MUJS.API.localStorage.setValue;MUJS.fn.deleteValue=MUJS.API.localStorage.deleteValue;MUJS.API.ParseMetaData_Types=[];MUJS.API.ParseMetaData_Types.push(function(name,obj){if(typeof obj==="object"){var history_patt=/\(([0-9\.]+)\)\s+(.*?)$/i;var o={};for(var i=0;i<obj.length;i++)if(history_patt.test(obj[i])){var r=history_patt.exec(obj[i]);var vers=r[1];var des=r[2];if(typeof o[vers]==="undefined")o[vers]=
[];o[vers].push(des)}return o}return undefined});MUJS.API.ParseMetaData=function(headerBlock){if(typeof headerBlock==="string")headerBlock=headerBlock.split(/\r?\n/i);var o={};var patt=/@([\S]+)\s+(.*?)$/i;for(var i=0;i<headerBlock.length;i++)if(patt.test(headerBlock[i])){var r=patt.exec(headerBlock[i]);if(typeof o[r[1]]==="undefined")o[r[1]]=r[2];else if(typeof o[r[1]]!=="string")o[r[1]].push(r[2]);else{tmp=o[r[1]];o[r[1]]=[];o[r[1]].push(tmp);o[r[1]].push(r[2])}}for(var key in o)for(var i=0;i<MUJS.API.ParseMetaData_Types.length;i++){var tmp=
MUJS.API.ParseMetaData_Types[i](key,o[key]);if(typeof tmp!=="undefined"){o[key]=tmp;break}}return o};MUJS.fn.getDOMTiming=function(){var timingData={};try{if(performance.available){var ignore=["unloadEventStart","unloadEventEnd","navigationStart"];timingData=performance.getAllTiming();for(var key in timingData){timingData[key]=timingData[key]-performance.get("timing.navigationStart");if(timingData[key]<=0)delete timingData[key]}var pageLoadTime=(performance.get("timing.loadEventEnd")||performance.get("timing.loadEventStart"))-
performance.get("timing.navigationStart");if(pageLoadTime>0)timingData["pageLoadTime"]=pageLoadTime;var NetworkLatency=performance.get("timing.responseEnd")-performance.get("timing.fetchStart");if(NetworkLatency>=0)timingData["NetworkLatency"]=NetworkLatency;var statReportTime=performance.now;console.log("statReportTime",statReportTime);if(statReportTime>0)timingData["statReportTime"]=statReportTime;if(mujsAPILoadStart>0)timingData["mujsAPILoadStart"]=mujsAPILoadStart;if(mujsAPILoadEnd>0)timingData["mujsAPILoadEnd"]=
mujsAPILoadEnd;if(mujsAPILoadStart>0&&mujsAPILoadEnd>0&&mujsAPILoadEnd-mujsAPILoadStart>0)timingData["mujsAPILoadTime"]=mujsAPILoadEnd-mujsAPILoadStart}}catch(e){console.log("Error! getDOMTiming: ",e);return{}}return timingData};MUJS.fn["UPDATE"]=new function(){var combineOptions=function(){var args=Array.prototype.slice.call(arguments,0);var output=merge.apply(merge,args);if(typeof output.Update!=="undefined"&&typeof output.Update.script_info!=="undefined")output.Update.script_info=MUJS.config("Update.script_info");
return output};this.getJSON=function(url,data){$.ajax({dataType:"jsonp",url:url+"&json=1",async:true}).done(function(result){unsafeWindow[MUJS.Config.Update.updateVeriableName]=result;MUJS.UPDATE.execCallback(data,result)}).fail(function(e){MUJS.UPDATE.execCallback(data,undefined,"error",e)})};this.getXMLHttpRequest=function(url,data){try{if(GM_xmlhttpRequest){GM_xmlhttpRequest({method:"GET",url:url,headers:{"Accept":"application/javascript"},onload:function(response){var responseJSON=JSON.parse(response.responseText);
MUJS.UPDATE.execCallback(data,responseJSON)},onerror:function(){console.log("Error! getXMLHttpRequest",response)}});return true}}catch(e){console.log("Error! getXMLHttpRequest",e)}return false};this.getCallbackFunction=function(data){if(typeof data.callback==="string"){if(typeof unsafeWindow[data.callback]!=="undefined")return unsafeWindow[data.callback]}else if(typeof data.callback!=="undefined")return data.callback;else if(typeof MUJS.config("currentCallback")!=="undefined")if(typeof MUJS.config("currentCallback")===
"string")return unsafeWindow[MUJS.config("currentCallback")];else return MUJS.config("currentCallback");return undefined};this.execCallback=function(data,result){var args=Array.prototype.slice.call(arguments,1);var cb=this.getCallbackFunction(data);if(cb!==undefined)cb.apply(cb.callback,args)};this.getURL=function(data){opts=combineOptions({},MUJS.Config.Update,data);if(opts.callback&&typeof opts.callback==="string")opts.callback_function=opts.callback;var builder=URLBuilder(MUJS.config("host")||
"http://myuserjs.org");var un=(opts.username||MUJS.config("script.username")).trim();if(typeof un==="undefined"||un=="")throw"No Username Provided";var sn=(opts.script_name||MUJS.config("script.script_name")).trim();if(typeof sn==="undefined"||sn=="")throw"No Script Name Provided";var gt=opts.getType||MUJS.config("Update.getType");if(gt!="meta"&&gt!="metajs"&&gt!="data"&&gt!="none")gt="data";var args=opts.args;if(opts.DOMTiming){var domTiming=MUJS.getDOMTiming();if(MUJS.config("debug"))MUJS.Log("domTiming",
domTiming);for(var key in domTiming)if(domTiming.hasOwnProperty(key))args[key]=domTiming[key]}var args_arr=[];for(var key in args)args_arr.push(key+"="+args[key]);builder.addArg("args",escape(args_arr.join(",")));builder.addArg("api_version",MUJS.version);builder.addArg("updateVeriableName",opts.updateVeriableName);if(typeof opts.callback_function!=="undefined")builder.addArg("jsonp",opts.callback_function);if(typeof opts.noDownload!=="undefined"&&opts.noDownload==true)builder.addArg("nodownload",
"1");else if(MUJS.config("Update.sampleRate")<100)if(Math.floor(Math.random()*100+1)>MUJS.config("Update.sampleRate"))builder.addArg("nodownload","1");if(MUJS.config("Update.getStats"))builder.addArg("getstats","1");if(typeof opts.script_info!=="undefined"){if(typeof opts.script_info.version!=="undefined")builder.addArg("scriptversion",escape(opts.script_info.version));if(typeof opts.script_info.script_handler!=="undefined"){builder.addArg("scripthandler",escape(opts.script_info.script_handler));
if(typeof opts.script_info.script_handler_version!=="undefined")builder.addArg("scripthandlerversion",escape(opts.script_info.script_handler_version))}}builder.addArg("cachebuster",Math.round((new Date).getTime()/1E3));var host=MUJS.config("host")||"myuserjs.org";builder.setPath("/script/"+un+"/"+sn+"."+gt+".js");return builder.toString()};this.sendRequest=function(data){try{var mData=combineOptions({},MUJS.Config.Update,data);if(typeof unsafeWindow[mData.updateVeriableName]!=="undefined"){unsafeWindow[mData.updateVeriableName]=
undefined;delete unsafeWindow[mData.updateVeriableName]}if(MUJS.config("scopeLock")&&mData.callback&&mData["getType"]!="none"){MUJS.config("currentCallback",mData.callback);mData.callback="MUJSExtResponseCallback"}else MUJS.config("currentCallback",null);var url=MUJS.UPDATE.getURL(mData);if(MUJS.config("debug"))MUJS.Log(url);var r;if(mData.XMLHttpRequest)r=this.getXMLHttpRequest(url,mData);if(!r&&mData.jQuery)r=this.getJSON(url,mData);else r=MUJS.API.addScript(undefined,url,undefined,true);if(mData.callback&&
mData["getType"]!="none")if(typeof mData.callback==="string"&&this.getCallbackFunction(mData)!==undefined);else MUJS.UPDATE.waitForResponse(mData);return r}catch(e){console.log("Error! getUpdateData: ",e.name,e.fileName,e.lineNumber+":"+e.columnNumber);console.log(e);return undefined}};this.getUpdateData=function(data){return this.sendRequest(data)};this.waitForResponse=function(data,count){if(typeof count==="undefined")count=0;if(typeof unsafeWindow[data.updateVeriableName]!=="undefined"){console.log("updateVeriable ready");
return MUJS.UPDATE.execCallback(data,unsafeWindow[data.updateVeriableName],"Success!")}else{if(count>100)return MUJS.UPDATE.execCallback(data,undefined,"Error! TimedOut");return setTimeout(MUJS.UPDATE.waitForResponse,100,data,count+1)}};this.extResponse=function(response){var args=Array.prototype.slice.call(arguments,0);var cb=MUJS.UPDATE.getCallbackFunction({callback:MUJS.config("currentCallback")});if(typeof cb!=="undefined")cb.apply(cb,args);else console.log("extResponse error! cant find cb")}};
mExportFunction(MUJS.UPDATE.extResponse,unsafeWindow,{defineAs:"MUJSExtResponseCallback",allowCallbacks:true,allowCrossOriginArguments:true});Object.defineProperty(MUJS.UPDATE,"MetaData",{get:function(varName){if(typeof unsafeWindow[varName||MUJS.Config.Update.updateVeriableName]!=="undefined")return unsafeWindow[varName||MUJS.Config.Update.updateVeriableName];else if(typeof window[varName||MUJS.Config.Update.updateVeriableName]!=="undefined")return window[varName||MUJS.Config.Update.updateVeriableName];
return undefined}});MUJS.fn["ERROR"]=new function(){this.ERROR_CODES={ERROR_RESULT:{FATAL:1048576},ERROR_NAME:{EVALERROR:65536,INTERNALERROR:131072,RANGEERROR:196608,REFERENCEERROR:262144,SYNTAXERROR:327680,TYPEERROR:393216,URIERROR:458752}};Object.defineProperties(this.ERROR_CODES,props);Object.defineProperty(this.ERROR_CODES,"get",{value:function(key,value){if(typeof value==="undefined")return MUJS.ERROR.ERROR_CODES.SearchForKey(key);else return MUJS.ERROR.ERROR_CODES.setKeyValue(key,value)},enumerable:false});
this.getCode=function(key){var val=this.ERROR_CODES.get(key);if(typeof val!=="undefined")return Number(val.toString(2));return undefined};var defaultFilter=function(message,url,linenumber,colNumber,eObj,stackInfo){try{if(MUJS.config("Update.script_info.userscript_file_name")==stackInfo[0].fileName){console.log("Error is from userscript!");switch(eObj.name){case "EvalError":case "InternalError":case "RangeError":case "ReferenceError":case "SyntaxError":case "TypeError":case "URIError":default:break}return true}}catch(e){}finally{return false}};
this.send=function(data){try{var mData=merge({},MUJS.Config.Update,data);if(typeof mData.args==="undefined")mData.args={};if(typeof mData.args["scriptError"]==="undefined")mData.args["scriptError"]="1";if(typeof mData.args["scriptErrorCode"]==="undefined")mData.args["scriptErrorCode"]="-1";mData.getType="none";mData.noDownload=true;return MUJS["UPDATE"]["sendRequest"](mData)}catch(e){console.log("Error! Error.send: ",e);return undefined}};this.catchError=function(message,url,linenumber,colNumber,
eObj,stackInfo){try{if(typeof eObj!=="undefined"&&typeof eObj.stack!=="undefined"){var args=Array.prototype.slice.call(arguments,0);if(MUJS.config("Error.autoReportErrors")){var filter=MUJS.config("Error.errorFilter").apply(this,args);if(filter){var opts={getType:"none",args:{}};opts.args.scriptErrorLineNumber=linenumber;opts.args.scriptErrorColNumber=colNumber;switch(typeof filter){case "object":opts.args=merge(opts.args,filter);break;case "number":case "string":opts.args.scriptError=filter;break;
case "boolean":opts.args.scriptError="1";break}}}}}catch(e){}return false};this.processError=function(e){var tStack="";try{tStack=e.stack.toString()}catch(e){}var data={message:e.message,name:e.name,fileName:e.fileName,lineNumber:e.lineNumber,columnNumber:e.columnNumber,stack:tStack};return MUJS["ERROR"]["catchError"](e.message,e.fileName,e.lineNumber,e.columnNumber,data,MUJS["ERROR"].parseStack(tStack))};this.parseStack=function(stackText){var o=[];var anonFunctionPatt=/\@((?:https?\:\/\/)?[^\s\:]+).*?([^\:\s]*)?\:(\d+)(?:\:(\d+))?\s*$/gi;
var stackPatt=/([^\s]*)\@file\:\/\/\/([^\s]+?(?:\/([^\/]+?\.(user\.js|js|json|php)))?):(\d+)(?:\:(\d+))?/gi;var match;while((match=stackPatt.exec(stackText))!=null){var tmp={functionName:match[1],fullFileName:match[2],fileName:match[3],fileExt:match[4],lineNumber:match[5],columnNumber:match[6]};o.push(tmp)}return o}};function MUJSListenError(message,url,linenumber,colNumber,data){console.log("MUJSListenError",message,url,linenumber,colNumber);var tData=MUJS["ERROR"]["parseStack"](data.stack);if(tData.length>
0)return MUJS["ERROR"]["catchError"](message,url,linenumber,colNumber,data,tData)}mExportFunction(MUJSListenError,unsafeWindow,{defineAs:"MUJSListenError",allowCallbacks:true,allowCrossOriginArguments:true});var onErrorFunction=function(){window.oldHandle=window.onerror;window.onerror=function(message,url,linenumber,colNumber,eObj){try{var args=Array.prototype.slice.call(arguments,0);var tStack="";try{tStack=eObj.stack.toString()}catch(e){}var data={message:eObj.message,name:eObj.name,fileName:eObj.fileName,
lineNumber:eObj.lineNumber,columnNumber:eObj.columnNumber,stack:tStack};if(MUJSListenError(message,url,linenumber,colNumber,data))return true}catch(e){}finally{if(window.oldHandle)return window.oldHandle.apply(this,args);return false}}};var MUJSRequire={DOMLoaded:false,documentComplete:false,onErrorFunctionAdded:false,Complete:false,scriptExecCount:0,manualCallCount:0};function RemoveEventListener_BeforeScriptExec(){window.removeEventListener("beforescriptexecute",BeforeScriptExec,true)}function BeforeScriptExec(e){if(!MUJSRequire.DOMLoaded){if(document.readyState!=
"uninitialized"&&document.readyState!="loading")MUJSRequire.DOMLoaded=true}else if(!MUJSRequire.onErrorFunctionAdded){MUJSRequire.onErrorFunctionAdded=true;setTimeout(function(){MUJS.API.contentEval(onErrorFunction);MUJS["events"]["fire"]("onReady")},1)}else if(!MUJSRequire.documentComplete)if(document.readyState==="complete"&&typeof unsafeWindow.performance!=="undefined"&&typeof unsafeWindow.performance.timing!=="undefined"){var pageLoadTime=(unsafeWindow.performance.timing.loadEventEnd||unsafeWindow.performance.timing.loadEventStart)-
unsafeWindow.performance.timing.navigationStart;if(pageLoadTime>0||MUJSRequire.scriptExecCount+MUJSRequire.manualCallCount>=50){MUJSRequire.documentComplete=true;MUJS["events"]["fire"]("onPageReady")}}else{if(MUJSRequire.scriptExecCount+MUJSRequire.manualCallCount>=50){MUJSRequire.documentComplete=true;MUJS["events"]["fire"]("onPageReady")}}else{MUJSRequire.Complete=true;clearCheckTimer();RemoveEventListener_BeforeScriptExec()}if(typeof e!=="undefined")MUJSRequire.scriptExecCount++;else MUJSRequire.manualCallCount++}
window.addEventListener("beforescriptexecute",BeforeScriptExec,true);function checkTimer(){var currentTime=performance.now;if(!MUJSRequire.Complete)BeforeScriptExec();else{RemoveEventListener_BeforeScriptExec();clearCheckTimer()}}function clearCheckTimer(){clearInterval(checkTimer)}setInterval(checkTimer,100);if(performance.available)mujsAPILoadEnd=performance.now})(MUJS,typeof jQuery!=="undefined"?jQuery:undefined);unsafeWindow["MUJS"]=MUJS;
